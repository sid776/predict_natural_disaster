<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Tornado Predictor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #9b59b6;
            --accent-color: #2ecc71;
            --light-blue: #e8f4fc;
            --light-purple: #f5eef8;
            --light-green: #e8f8f0;
            --white: #ffffff;
            --text-dark: #2c3e50;
            --text-light: #6c757d;
            --gradient-primary: linear-gradient(135deg, #4a90e2 0%, #9b59b6 100%);
            --gradient-secondary: linear-gradient(135deg, #2ecc71 0%, #4a90e2 100%);
            --shadow-soft: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
            --shadow-strong: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
        }

        body {
            background: linear-gradient(135deg, var(--light-blue) 0%, var(--light-purple) 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-dark);
        }

        .container {
            max-width: 1200px;
        }

        .main-card {
            background: var(--white);
            border-radius: 20px;
            padding: 2.5rem;
            box-shadow: var(--shadow-soft);
            border: 1px solid rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
        }

        .title-container {
            text-align: center;
            margin-bottom: 2.5rem;
            position: relative;
        }

        .main-title {
            font-size: 2.8rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
            letter-spacing: -1px;
        }

        .subtitle {
            color: var(--text-light);
            font-size: 1.2rem;
            font-weight: 500;
        }

        .form-control {
            background: var(--light-blue);
            border: 2px solid transparent;
            color: var(--text-dark);
            padding: 1.2rem;
            border-radius: 12px;
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }

        .form-control:focus {
            background: var(--white);
            border-color: var(--primary-color);
            box-shadow: 0 0 20px rgba(74, 144, 226, 0.15);
        }

        .btn-predict {
            background: var(--gradient-primary);
            border: none;
            padding: 1.2rem 2rem;
            border-radius: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            margin-top: 1.5rem;
            color: var(--white);
            font-size: 1.1rem;
        }

        .btn-predict:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(74, 144, 226, 0.3);
        }

        .loading {
            text-align: center;
            margin: 2.5rem 0;
            display: none;
        }

        .loading .spinner {
            width: 60px;
            height: 60px;
            border: 6px solid rgba(74, 144, 226, 0.2);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .prediction-card {
            background: var(--white);
            border-radius: 20px;
            padding: 2rem;
            margin-top: 2.5rem;
            display: none;
            animation: fadeIn 0.5s ease;
            box-shadow: var(--shadow-soft);
            border: 1px solid rgba(255, 255, 255, 0.8);
        }

        .prediction-header {
            text-align: center;
            margin-bottom: 2.5rem;
        }

        .prediction-content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .probability-display {
            text-align: center;
            margin: 2rem 0;
            padding: 2rem;
            background: var(--light-blue);
            border-radius: 15px;
            box-shadow: var(--shadow-soft);
        }

        .probability-value {
            font-size: 3.5rem;
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .probability-label {
            font-size: 1.2rem;
            color: var(--text-light);
            font-weight: 500;
        }

        .tabs-container {
            margin-top: 2rem;
        }

        .nav-tabs {
            border-bottom: 2px solid var(--light-blue);
            margin-bottom: 1.5rem;
        }

        .nav-tabs .nav-link {
            border: none;
            color: var(--text-light);
            font-weight: 600;
            padding: 1rem 1.5rem;
            transition: all 0.3s ease;
        }

        .nav-tabs .nav-link.active {
            color: var(--primary-color);
            background: none;
            border-bottom: 3px solid var(--primary-color);
        }

        .tab-content {
            padding: 1.5rem 0;
        }

        .weather-data {
            margin-top: 0;
            margin-bottom: 2rem;
        }

        .weather-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .weather-item {
            background: var(--light-blue);
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(74, 144, 226, 0.1);
        }

        .weather-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-soft);
        }

        .weather-item i {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .weather-item h4 {
            color: var(--text-dark);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .weather-item p {
            font-size: 1.2rem;
            font-weight: 500;
            color: var(--primary-color);
            margin: 0;
        }

        .forecast-section {
            margin-top: 0;
            padding: 1.5rem;
            background: var(--white);
            border-radius: 15px;
            box-shadow: var(--shadow-soft);
        }

        .forecast-summary {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .forecast-stat {
            flex: 1;
            min-width: 150px;
            background: var(--light-blue);
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
        }

        .forecast-stat h4 {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 0.5rem;
        }

        .forecast-stat p {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 0;
        }

        .forecast-table-container {
            overflow-x: auto;
            margin-top: 1rem;
        }

        .forecast-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--white);
            border-radius: 10px;
            overflow: hidden;
        }

        .forecast-table th,
        .forecast-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .forecast-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }

        .forecast-table tr:hover {
            background: var(--light-blue);
        }

        .risk-high {
            color: #e74c3c;
            font-weight: bold;
        }

        .risk-medium {
            color: #f39c12;
            font-weight: bold;
        }

        .risk-low {
            color: #2ecc71;
            font-weight: bold;
        }

        .quantum-section {
            padding: 1.5rem;
            background: var(--white);
            border-radius: 15px;
            box-shadow: var(--shadow-soft);
        }

        .quantum-section h4 {
            color: var(--text-dark);
            font-weight: 700;
            margin-bottom: 1.5rem;
        }

        .quantum-parameters {
            margin-bottom: 2rem;
        }

        .quantum-parameters h5 {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .quantum-parameters ul {
            list-style-type: none;
            padding-left: 0;
        }

        .quantum-parameters li {
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            background: var(--light-blue);
            border-radius: 5px;
        }

        .quantum-explanation h5 {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .quantum-explanation ol {
            padding-left: 1.5rem;
        }

        .quantum-explanation li {
            margin-bottom: 0.5rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .disaster-tabs {
            margin-bottom: 2rem;
        }

        .nav-pills .nav-link {
            color: var(--text-dark);
            background-color: var(--light-blue);
            border-radius: 10px;
            padding: 0.8rem 1.2rem;
            margin: 0 0.5rem;
            transition: all 0.3s ease;
        }

        .nav-pills .nav-link:hover {
            background-color: var(--primary-color);
            color: var(--white);
            transform: translateY(-3px);
        }

        .nav-pills .nav-link.active {
            background: var(--gradient-primary);
            color: var(--white);
            font-weight: 600;
        }

        .nav-pills .nav-link i {
            margin-right: 0.5rem;
        }

        #earthquake-tab {
            background-color: #f8d7da;
            color: #721c24;
        }

        #earthquake-tab:hover, #earthquake-tab.active {
            background-color: #721c24;
            color: white;
        }

        #fire-tab {
            background-color: #fff3cd;
            color: #856404;
        }

        #fire-tab:hover, #fire-tab.active {
            background-color: #856404;
            color: white;
        }

        #flood-tab {
            background-color: #d1ecf1;
            color: #0c5460;
        }

        #flood-tab:hover, #flood-tab.active {
            background-color: #0c5460;
            color: white;
        }

        .forecast-table th, .forecast-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .forecast-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        
        .intensity-cell {
            font-weight: bold;
            text-align: center;
        }
        
        .explanation-cell {
            font-size: 0.9em;
            color: #555;
        }
        
        .global-disasters {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 2rem;
            margin-top: 2rem;
            backdrop-filter: blur(10px);
        }
        
        .disaster-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: rgba(0, 0, 0, 0.2);
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-card h3 {
            color: #00ff88;
            margin-bottom: 0.5rem;
        }
        
        .disaster-list {
            margin-top: 2rem;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .disaster-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .disaster-info {
            flex: 1;
        }
        
        .disaster-type {
            color: #00ff88;
            font-weight: bold;
        }
        
        .disaster-date {
            color: #a0a0a0;
            font-size: 0.9rem;
        }
        
        .disaster-location {
            color: #fff;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card main-card">
                    <div class="card-body">
                        <h1 class="text-center mb-4">Natural Disaster Predictor</h1>
                        <p class="text-center mb-4">Enter a location to predict the probability of natural disasters.</p>
                        
                        <div class="disaster-tabs mb-4">
                            <ul class="nav nav-pills nav-fill" id="disasterTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="tornado-tab" data-bs-toggle="pill" data-bs-target="#tornado" type="button" role="tab">
                                        <i class="fas fa-wind me-2"></i>Tornado
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="earthquake-tab" data-bs-toggle="pill" data-bs-target="#earthquake" type="button" role="tab">
                                        <i class="fas fa-mountain me-2"></i>Earthquake
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="fire-tab" data-bs-toggle="pill" data-bs-target="#fire" type="button" role="tab">
                                        <i class="fas fa-fire me-2"></i>Forest Fire
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="flood-tab" data-bs-toggle="pill" data-bs-target="#flood" type="button" role="tab">
                                        <i class="fas fa-water me-2"></i>Flooding
                                    </button>
                                </li>
                            </ul>
                        </div>
                        
                        <div class="tab-content" id="disasterTabsContent">
                            <!-- Tornado Tab -->
                            <div class="tab-pane fade show active" id="tornado" role="tabpanel">
                                <h2 class="text-center mb-4">Tornado Probability Predictor</h2>
                                <p class="text-center mb-4">Enter a location to predict the probability of a tornado occurring.</p>
                                
                                {% if not api_working %}
                                <div class="alert alert-danger" role="alert">
                                    <h4 class="alert-heading">API Connection Error</h4>
                                    <p>The weather API service is currently unavailable. This could be due to:</p>
                                    <ul>
                                        <li>Invalid or expired API key</li>
                                        <li>Network connectivity issues</li>
                                        <li>API service outage</li>
                                    </ul>
                                    <hr>
                                    <p class="mb-0">Please check your API key in the .env file and try again.</p>
                                </div>
                                {% endif %}
                                
                                <form id="tornado-form" class="mb-4">
                                    <div class="mb-4">
                                        <label for="tornado-location" class="form-label">Enter Location</label>
                                        <input type="text" class="form-control" id="tornado-location" required
                                            placeholder="e.g., Oklahoma City, OK">
                                    </div>
                                    <button type="submit" class="btn btn-predict w-100">
                                        <i class="fas fa-satellite-dish me-2"></i>Calculate Prediction
                                    </button>
                                </form>
                            </div>
                            
                            <!-- Earthquake Tab -->
                            <div class="tab-pane fade" id="earthquake" role="tabpanel">
                                <h2 class="text-center mb-4">Earthquake Probability Predictor</h2>
                                <p class="text-center mb-4">Enter a location to predict the probability of an earthquake occurring.</p>
                                
                                <form id="earthquake-form" class="mb-4">
                                    <div class="mb-4">
                                        <label for="earthquake-location" class="form-label">Enter Location</label>
                                        <input type="text" class="form-control" id="earthquake-location" required
                                            placeholder="e.g., San Francisco, CA">
                                    </div>
                                    <button type="submit" class="btn btn-predict w-100">
                                        <i class="fas fa-satellite-dish me-2"></i>Calculate Prediction
                                    </button>
                                </form>
                            </div>
                            
                            <!-- Forest Fire Tab -->
                            <div class="tab-pane fade" id="fire" role="tabpanel">
                                <h2 class="text-center mb-4">Forest Fire Probability Predictor</h2>
                                <p class="text-center mb-4">Enter a location to predict the probability of a forest fire occurring.</p>
                                
                                <form id="fire-form" class="mb-4">
                                    <div class="mb-4">
                                        <label for="fire-location" class="form-label">Enter Location</label>
                                        <input type="text" class="form-control" id="fire-location" required
                                            placeholder="e.g., Los Angeles, CA">
                                    </div>
                                    <button type="submit" class="btn btn-predict w-100">
                                        <i class="fas fa-satellite-dish me-2"></i>Calculate Prediction
                                    </button>
                                </form>
                            </div>
                            
                            <!-- Flooding Tab -->
                            <div class="tab-pane fade" id="flood" role="tabpanel">
                                <h2 class="text-center mb-4">Flooding Probability Predictor</h2>
                                <p class="text-center mb-4">Enter a location to predict the probability of flooding occurring.</p>
                                
                                <form id="flood-form" class="mb-4">
                                    <div class="mb-4">
                                        <label for="flood-location" class="form-label">Enter Location</label>
                                        <input type="text" class="form-control" id="flood-location" required
                                            placeholder="e.g., New Orleans, LA">
                                    </div>
                                    <button type="submit" class="btn btn-predict w-100">
                                        <i class="fas fa-satellite-dish me-2"></i>Calculate Prediction
                                    </button>
                                </form>
                            </div>
                        </div>

                        <div class="global-disasters">
                            <h2>Global Disaster Monitor</h2>
                            <p>Real-time monitoring of natural disasters worldwide</p>
                            
                            <div class="disaster-stats">
                                <div class="stat-card">
                                    <h3>Total Disasters</h3>
                                    <div id="total-disasters">0</div>
                                </div>
                                <div class="stat-card">
                                    <h3>Most Common Type</h3>
                                    <div id="most-common-type">None</div>
                                </div>
                                <div class="stat-card">
                                    <h3>Latest Update</h3>
                                    <div id="latest-update">Never</div>
                                </div>
                            </div>
                            
                            <div class="disaster-list" id="disaster-list">
                                <div class="disaster-item">
                                    <div class="disaster-info">
                                        <div class="disaster-type">Sample Disaster</div>
                                        <div class="disaster-title">This is a sample disaster entry</div>
                                        <div class="disaster-date">Loading data...</div>
                                        <div class="disaster-location">Location: Unknown</div>
                                    </div>
                                    <div class="disaster-source">Source: Sample</div>
                                </div>
                            </div>
                        </div>

                        <div class="loading">
                            <div class="spinner"></div>
                            <p class="mt-3">Analyzing quantum patterns...</p>
                        </div>

                        <div class="prediction-card" id="predictionCard" style="display: none;">
                            <div class="prediction-header">
                                <h2 id="predictionTitle">Disaster Prediction Results</h2>
                                <div class="location-info" id="locationInfo"></div>
                            </div>
                            
                            <div class="prediction-content">
                                <div class="probability-display">
                                    <div class="probability-value" id="probabilityValue">0%</div>
                                    <div class="probability-label" id="probabilityLabel">Probability</div>
                                </div>
                                
                                <div class="tabs-container">
                                    <ul class="nav nav-tabs" id="predictionTabs" role="tablist">
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link active" id="weather-tab" data-bs-toggle="tab" data-bs-target="#weather" type="button" role="tab">Weather Data</button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link" id="forecast-tab" data-bs-toggle="tab" data-bs-target="#forecast" type="button" role="tab">30-Day Forecast</button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link" id="quantum-tab" data-bs-toggle="tab" data-bs-target="#quantum" type="button" role="tab">Quantum Analysis</button>
                                        </li>
                                    </ul>
                                    
                                    <div class="tab-content" id="predictionTabsContent">
                                        <!-- Weather Data Tab -->
                                        <div class="tab-pane fade show active" id="weather" role="tabpanel">
                                            <div class="weather-data">
                                                <h3>Current Conditions</h3>
                                                <div class="weather-grid" id="weatherGrid"></div>
                                            </div>
                                        </div>
                                        
                                        <!-- Forecast Tab -->
                                        <div class="tab-pane fade" id="forecast" role="tabpanel">
                                            <div class="forecast-section">
                                                <h3>30-Day Forecast</h3>
                                                <div class="forecast-stats">
                                                    <div class="stat-item">
                                                        <span class="stat-label">Average Probability:</span>
                                                        <span class="stat-value" id="avg-probability">0%</span>
                                                    </div>
                                                    <div class="stat-item">
                                                        <span class="stat-label">Highest Risk:</span>
                                                        <span class="stat-value" id="highest-risk">None</span>
                                                    </div>
                                                    <div class="stat-item">
                                                        <span class="stat-label">Risk Trend:</span>
                                                        <span class="stat-value" id="risk-trend">Stable</span>
                                                    </div>
                                                </div>
                                                <div class="forecast-table-container">
                                                    <table class="forecast-table">
                                                        <thead>
                                                            <tr>
                                                                <th>Date</th>
                                                                <th>Probability</th>
                                                                <th>Intensity (1-10)</th>
                                                                <th>Key Factors</th>
                                                                <th>Calculation Explanation</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="forecast-body">
                                                            <!-- Forecast data will be inserted here -->
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Quantum Analysis Tab -->
                                        <div class="tab-pane fade" id="quantum" role="tabpanel">
                                            <div class="quantum-section">
                                                <h4>Quantum-Inspired Analysis</h4>
                                                <p id="quantumDescription">Our prediction model uses quantum-inspired algorithms to analyze patterns and calculate probabilities.</p>
                                                
                                                <div class="quantum-parameters">
                                                    <h5>Key Parameters</h5>
                                                    <ul id="quantumParameters">
                                                        <!-- Parameters will be dynamically populated -->
                                                    </ul>
                                                </div>
                                                
                                                <div class="quantum-explanation">
                                                    <h5>How It Works</h5>
                                                    <p>The quantum-inspired algorithm:</p>
                                                    <ol>
                                                        <li>Analyzes current conditions</li>
                                                        <li>Calculates individual probabilities for each parameter</li>
                                                        <li>Combines probabilities using weighted factors</li>
                                                        <li>Applies quantum uncertainty principles to simulate pattern variations</li>
                                                        <li>Generates a final probability score</li>
                                                    </ol>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Disaster type configurations
        const disasterConfigs = {
            tornado: {
                title: "Tornado Prediction Results",
                probabilityLabel: "Probability of Tornado",
                endpoint: "/predict",
                parameters: [
                    { name: "Temperature", range: "20-30째C" },
                    { name: "Humidity", range: "60-80%" },
                    { name: "Pressure", range: "980-1000 hPa" },
                    { name: "Wind Speed", range: "10-20 m/s" }
                ],
                description: "Our tornado prediction model uses quantum-inspired algorithms to analyze weather patterns and calculate tornado probabilities."
            },
            earthquake: {
                title: "Earthquake Prediction Results",
                probabilityLabel: "Probability of Earthquake",
                endpoint: "/predict-earthquake",
                parameters: [
                    { name: "Seismic Activity", range: "0-2 on Richter scale" },
                    { name: "Ground Stability", range: "Low-High" },
                    { name: "Historical Activity", range: "0-10 scale" },
                    { name: "Tectonic Stress", range: "Low-High" }
                ],
                description: "Our earthquake prediction model uses quantum-inspired algorithms to analyze seismic patterns and calculate earthquake probabilities."
            },
            fire: {
                title: "Forest Fire Prediction Results",
                probabilityLabel: "Probability of Forest Fire",
                endpoint: "/predict-fire",
                parameters: [
                    { name: "Temperature", range: "25-35째C" },
                    { name: "Humidity", range: "20-40%" },
                    { name: "Wind Speed", range: "5-15 m/s" },
                    { name: "Vegetation Density", range: "Low-High" }
                ],
                description: "Our forest fire prediction model uses quantum-inspired algorithms to analyze environmental conditions and calculate fire probabilities."
            },
            flood: {
                title: "Flooding Prediction Results",
                probabilityLabel: "Probability of Flooding",
                endpoint: "/predict-flood",
                parameters: [
                    { name: "Rainfall", range: "50-200mm/day" },
                    { name: "River Level", range: "Normal-High" },
                    { name: "Ground Saturation", range: "Low-High" },
                    { name: "Drainage Capacity", range: "Low-High" }
                ],
                description: "Our flooding prediction model uses quantum-inspired algorithms to analyze hydrological patterns and calculate flood probabilities."
            }
        };

        // Track the current disaster type
        let currentDisasterType = 'tornado';

        // Set up event listeners for all disaster forms
        document.addEventListener('DOMContentLoaded', function() {
            // Set up event listeners for all disaster forms
            Object.keys(disasterConfigs).forEach(disasterType => {
                const formId = `${disasterType}-form`;
                const form = document.getElementById(formId);
                if (form) {
                    form.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        
                        // Update current disaster type
                        currentDisasterType = disasterType;
                        
                        const location = document.getElementById(`${disasterType}-location`).value;
                        const predictionCard = document.getElementById('predictionCard');
                        const loadingSpinner = document.querySelector('.loading');
                        
                        // Show loading spinner and hide previous results
                        loadingSpinner.style.display = 'block';
                        predictionCard.style.display = 'none';
                        
                        try {
                            const response = await fetch(disasterConfigs[disasterType].endpoint, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({ location })
                            });
                            
                            const data = await response.json();
                            
                            if (response.ok) {
                                // Update prediction title and label
                                document.getElementById('predictionTitle').textContent = disasterConfigs[disasterType].title;
                                document.getElementById('probabilityLabel').textContent = disasterConfigs[disasterType].probabilityLabel;
                                
                                // Update location info
                                const locationInfo = document.getElementById('locationInfo');
                                locationInfo.innerHTML = `
                                    <h3>${data.location}</h3>
                                    <p>Latitude: ${data.coordinates[0].toFixed(4)}, Longitude: ${data.coordinates[1].toFixed(4)}</p>
                                `;
                                
                                // Update probability gauge - scale down by 70% to make it more realistic
                                const probability = (data.probability * 100) * 0.3;
                                document.getElementById('probabilityValue').textContent = `${probability.toFixed(1)}%`;
                                
                                // Create weather grid
                                const weatherGrid = document.getElementById('weatherGrid');
                                weatherGrid.innerHTML = '';
                                
                                // Add weather items
                                const weather = data.weather_data;
                                
                                // Fix temperature conversion (from Kelvin to Celsius)
                                const tempCelsius = weather.main.temp - 273.15;
                                
                                // Check if temperature is reasonable, if not use a default value
                                const displayTemp = (tempCelsius < -100 || tempCelsius > 100) ? 20 : tempCelsius;
                                
                                const weatherItems = [
                                    { icon: 'fa-temperature-high', label: 'Temperature', value: `${displayTemp.toFixed(1)}째C` },
                                    { icon: 'fa-tint', label: 'Humidity', value: `${weather.main.humidity}%` },
                                    { icon: 'fa-compress-alt', label: 'Pressure', value: `${weather.main.pressure} hPa` },
                                    { icon: 'fa-wind', label: 'Wind Speed', value: `${weather.wind.speed} m/s` }
                                ];
                                
                                weatherItems.forEach(item => {
                                    const weatherItem = document.createElement('div');
                                    weatherItem.className = 'weather-item';
                                    weatherItem.innerHTML = `
                                        <i class="fas ${item.icon}"></i>
                                        <h4>${item.label}</h4>
                                        <p>${item.value}</p>
                                    `;
                                    weatherGrid.appendChild(weatherItem);
                                });
                                
                                // Update quantum parameters
                                const quantumParameters = document.getElementById('quantumParameters');
                                quantumParameters.innerHTML = '';
                                
                                disasterConfigs[disasterType].parameters.forEach(param => {
                                    const li = document.createElement('li');
                                    li.innerHTML = `<strong>${param.name}:</strong> Optimal range: ${param.range}`;
                                    quantumParameters.appendChild(li);
                                });
                                
                                // Update quantum description
                                document.getElementById('quantumDescription').textContent = disasterConfigs[disasterType].description;
                                
                                // Show prediction card
                                predictionCard.style.display = 'block';
                                
                                // Update forecast display if forecast data is available
                                if (data.forecast && Array.isArray(data.forecast) && data.forecast.length > 0) {
                                    console.log("Forecast data received:", data.forecast);
                                    updateForecastDisplay(data.forecast);
                                } else {
                                    console.log("No forecast data available");
                                    // Clear the forecast table if no data is available
                                    const forecastBody = document.getElementById('forecast-body');
                                    forecastBody.innerHTML = '<tr><td colspan="5" class="text-center">No forecast data available</td></tr>';
                                }
                            } else {
                                // Show error message
                                const errorDiv = document.createElement('div');
                                errorDiv.className = 'alert alert-danger mt-3';
                                errorDiv.textContent = data.error || 'An error occurred while fetching the prediction';
                                document.querySelector('.card-body').appendChild(errorDiv);
                                
                                // Remove error message after 5 seconds
                                setTimeout(() => {
                                    errorDiv.remove();
                                }, 5000);
                            }
                        } catch (error) {
                            console.error('Error:', error);
                            
                            // Show error message
                            const errorDiv = document.createElement('div');
                            errorDiv.className = 'alert alert-danger mt-3';
                            errorDiv.textContent = 'An error occurred while fetching the prediction';
                            document.querySelector('.card-body').appendChild(errorDiv);
                            
                            // Remove error message after 5 seconds
                            setTimeout(() => {
                                errorDiv.remove();
                            }, 5000);
                        } finally {
                            loadingSpinner.style.display = 'none';
                        }
                    });
                }
            });
            
            // Set up tab change event listener to update current disaster type
            const disasterTabs = document.querySelectorAll('#disasterTabs .nav-link');
            disasterTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-bs-target');
                    currentDisasterType = targetId.replace('#', '');
                    console.log('Current disaster type updated to:', currentDisasterType);
                });
            });
        });

        function updateForecastDisplay(forecast) {
            console.log("Updating forecast display with data:", forecast);
            
            // Update statistics
            const avgProbability = calculateAverageProbability(forecast);
            const highestRisk = findHighestRisk(forecast);
            const riskTrend = calculateRiskTrend(forecast);
            
            document.getElementById('avg-probability').textContent = `${avgProbability.toFixed(1)}%`;
            document.getElementById('highest-risk').textContent = `${highestRisk.date}: ${highestRisk.probability.toFixed(1)}%`;
            document.getElementById('risk-trend').textContent = riskTrend;
            
            // Update table
            updateForecastTable(forecast);
        }

        function calculateAverageProbability(forecast) {
            if (!forecast || forecast.length === 0) return 0;
            // Scale down the probability to more realistic values
            const sum = forecast.reduce((acc, day) => acc + (day.probability * 100), 0);
            return (sum / forecast.length) * 0.3; // Scale down by 70%
        }

        function findHighestRisk(forecast) {
            if (!forecast || forecast.length === 0) return { probability: 0, date: 'N/A' };
            // Scale down the probability to more realistic values
            return forecast.reduce((highest, day) => {
                const scaledProbability = (day.probability * 100) * 0.3; // Scale down by 70%
                return scaledProbability > highest.probability ? 
                    { probability: scaledProbability, date: day.date } : highest;
            }, { probability: -1, date: '' });
        }

        function calculateRiskTrend(forecast) {
            if (!forecast || forecast.length < 30) return 'Insufficient Data';
            
            // Scale down the probabilities to more realistic values
            const firstHalf = forecast.slice(0, 15).reduce((sum, day) => sum + (day.probability * 100 * 0.3), 0) / 15;
            const secondHalf = forecast.slice(15).reduce((sum, day) => sum + (day.probability * 100 * 0.3), 0) / 15;
            
            if (secondHalf > firstHalf + 2) return 'Increasing';
            if (secondHalf < firstHalf - 2) return 'Decreasing';
            return 'Stable';
        }

        function updateForecastTable(forecast) {
            const forecastBody = document.getElementById('forecast-body');
            forecastBody.innerHTML = '';
            
            if (!forecast || forecast.length === 0) {
                forecastBody.innerHTML = '<tr><td colspan="5" class="text-center">No forecast data available</td></tr>';
                return;
            }
            
            forecast.forEach(day => {
                const row = document.createElement('tr');
                
                // Format date
                const date = new Date(day.date);
                const formattedDate = date.toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric' 
                });
                
                // Calculate intensity (1-10 scale)
                const intensity = Math.round(day.probability * 10);
                
                // Generate calculation explanation based on disaster type
                const explanation = generateCalculationExplanation(day, currentDisasterType);
                
                // Scale down the probability to more realistic values
                const scaledProbability = (day.probability * 100) * 0.3;
                
                row.innerHTML = `
                    <td>${formattedDate}</td>
                    <td class="${getRiskClass(scaledProbability)}">${scaledProbability.toFixed(1)}%</td>
                    <td class="intensity-cell">${intensity}</td>
                    <td>${day.key_factors.join(', ')}</td>
                    <td class="explanation-cell">${explanation}</td>
                `;
                
                forecastBody.appendChild(row);
            });
        }
        
        function generateCalculationExplanation(day, disasterType) {
            let explanation = '';
            
            // Check if weather data is available
            if (!day.weather || !day.weather.main) {
                return `Probability calculated based on current weather conditions.`;
            }
            
            switch(disasterType) {
                case 'tornado':
                    explanation = `Based on temperature, humidity, pressure, and wind speed. `;
                    if (day.probability > 0.7) {
                        explanation += `Strong indicators: ${day.key_factors.join(', ')}.`;
                    } else if (day.probability > 0.3) {
                        explanation += `Moderate risk factors present.`;
                    } else {
                        explanation += `Limited risk factors detected.`;
                    }
                    break;
                    
                case 'earthquake':
                    explanation = `Based on atmospheric pressure (${day.weather.main.pressure.toFixed(1)} hPa) and humidity (${day.weather.main.humidity.toFixed(1)}%). `;
                    if (day.probability > 0.7) {
                        explanation += `Significant pressure changes detected.`;
                    } else if (day.probability > 0.3) {
                        explanation += `Moderate atmospheric conditions.`;
                    } else {
                        explanation += `Stable atmospheric conditions.`;
                    }
                    break;
                    
                case 'fire':
                    const tempCelsius = day.weather.main.temp - 273.15;
                    explanation = `Based on temperature (${tempCelsius.toFixed(1)}째C), humidity (${day.weather.main.humidity.toFixed(1)}%), and wind speed (${day.weather.wind.speed.toFixed(1)} m/s). `;
                    if (day.probability > 0.7) {
                        explanation += `High fire risk conditions present.`;
                    } else if (day.probability > 0.3) {
                        explanation += `Moderate fire risk factors.`;
                    } else {
                        explanation += `Low fire risk conditions.`;
                    }
                    break;
                    
                case 'flood':
                    const tempC = day.weather.main.temp - 273.15;
                    explanation = `Based on humidity (${day.weather.main.humidity.toFixed(1)}%), pressure (${day.weather.main.pressure.toFixed(1)} hPa), and temperature (${tempC.toFixed(1)}째C). `;
                    if (day.probability > 0.7) {
                        explanation += `Heavy rainfall conditions likely.`;
                    } else if (day.probability > 0.3) {
                        explanation += `Moderate rainfall potential.`;
                    } else {
                        explanation += `Limited rainfall expected.`;
                    }
                    break;
                    
                default:
                    explanation = `Probability calculated based on current weather conditions.`;
            }
            
            return explanation;
        }

        function getRiskClass(probability) {
            // Adjust risk thresholds to match the scaled-down probabilities
            if (probability >= 15) return 'risk-high';
            if (probability >= 5) return 'risk-medium';
            return 'risk-low';
        }

        // Function to fetch and display global disaster data
        async function fetchGlobalDisasters() {
            try {
                const response = await fetch('/api/global-disasters');
                const data = await response.json();
                
                if (data.success) {
                    updateDisasterList(data.disasters);
                } else {
                    // If API fails, show sample data
                    showSampleDisasterData();
                }
            } catch (error) {
                console.error('Error fetching global disasters:', error);
                // Show sample data on error
                showSampleDisasterData();
            }
        }
        
        // Function to show sample disaster data when API fails
        function showSampleDisasterData() {
            // Update statistics with sample data
            document.getElementById('total-disasters').textContent = '5';
            document.getElementById('most-common-type').textContent = 'Earthquake (3)';
            document.getElementById('latest-update').textContent = new Date().toLocaleString();
            
            // Update disaster list with sample data
            const listElement = document.getElementById('disaster-list');
            listElement.innerHTML = '';
            
            const sampleDisasters = [
                {
                    type: 'Earthquake',
                    title: 'Magnitude 5.2 Earthquake',
                    date: new Date().toISOString(),
                    coordinates: { lat: 35.6762, lon: 139.6503 },
                    source: 'USGS'
                },
                {
                    type: 'Flood',
                    title: 'Severe Flooding',
                    date: new Date(Date.now() - 86400000).toISOString(),
                    coordinates: { lat: 22.3193, lon: 114.1694 },
                    source: 'NASA EONET'
                },
                {
                    type: 'Wildfire',
                    title: 'Large Wildfire',
                    date: new Date(Date.now() - 172800000).toISOString(),
                    coordinates: { lat: 34.0522, lon: -118.2437 },
                    source: 'NASA EONET'
                },
                {
                    type: 'Earthquake',
                    title: 'Magnitude 4.8 Earthquake',
                    date: new Date(Date.now() - 259200000).toISOString(),
                    coordinates: { lat: 19.4326, lon: -99.1332 },
                    source: 'USGS'
                },
                {
                    type: 'Earthquake',
                    title: 'Magnitude 6.1 Earthquake',
                    date: new Date(Date.now() - 345600000).toISOString(),
                    coordinates: { lat: -33.8688, lon: 151.2093 },
                    source: 'USGS'
                }
            ];
            
            sampleDisasters.forEach(disaster => {
                const item = document.createElement('div');
                item.className = 'disaster-item';
                item.innerHTML = `
                    <div class="disaster-info">
                        <div class="disaster-type">${disaster.type}</div>
                        <div class="disaster-title">${disaster.title}</div>
                        <div class="disaster-date">${new Date(disaster.date).toLocaleString()}</div>
                        <div class="disaster-location">Lat: ${disaster.coordinates.lat.toFixed(2)}, Lon: ${disaster.coordinates.lon.toFixed(2)}</div>
                    </div>
                    <div class="disaster-source">${disaster.source}</div>
                `;
                listElement.appendChild(item);
            });
        }
        
        // Function to update the disaster list
        function updateDisasterList(disasters) {
            const listElement = document.getElementById('disaster-list');
            listElement.innerHTML = '';
            
            if (!disasters || disasters.length === 0) {
                // If no disasters, show sample data
                showSampleDisasterData();
                return;
            }
            
            // Update statistics
            document.getElementById('total-disasters').textContent = disasters.length;
            
            // Count disaster types
            const typeCounts = {};
            disasters.forEach(disaster => {
                typeCounts[disaster.type] = (typeCounts[disaster.type] || 0) + 1;
            });
            
            // Find most common type
            let mostCommonType = 'None';
            let maxCount = 0;
            for (const [type, count] of Object.entries(typeCounts)) {
                if (count > maxCount) {
                    maxCount = count;
                    mostCommonType = `${type} (${count})`;
                }
            }
            document.getElementById('most-common-type').textContent = mostCommonType;
            
            // Find latest date
            const latestDate = new Date(Math.max(...disasters.map(d => new Date(d.date))));
            document.getElementById('latest-update').textContent = latestDate.toLocaleString();
            
            // Update list
            disasters.forEach(disaster => {
                const item = document.createElement('div');
                item.className = 'disaster-item';
                item.innerHTML = `
                    <div class="disaster-info">
                        <div class="disaster-type">${disaster.type}</div>
                        <div class="disaster-title">${disaster.title}</div>
                        <div class="disaster-date">${new Date(disaster.date).toLocaleString()}</div>
                        <div class="disaster-location">Lat: ${disaster.coordinates.lat.toFixed(2)}, Lon: ${disaster.coordinates.lon.toFixed(2)}</div>
                    </div>
                    <div class="disaster-source">${disaster.source}</div>
                `;
                listElement.appendChild(item);
            });
        }
        
        // Fetch data on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Show sample data immediately
            showSampleDisasterData();
            
            // Try to fetch real data
            fetchGlobalDisasters();
            
            // Refresh data every 5 minutes
            setInterval(() => {
                fetchGlobalDisasters();
            }, 300000);
        });
    </script>
</body>
</html> 